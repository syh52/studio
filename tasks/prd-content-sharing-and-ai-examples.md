# 产品需求文档 - 内容公共化与AI例句生成优化

## 1. 项目概述

### 问题描述
当前系统存在两个主要问题：
1. **内容隔离问题**：用户上传的词汇包和对话只有上传者自己能看到，无法实现内容共享
2. **例句质量差**：当前使用简单模板替换生成例句，内容僵硬、不自然

### 解决目标
- 实现用户上传内容的全局共享，让所有用户都能访问和学习
- 使用AI技术生成高质量、自然的例句，提升学习体验

## 2. 项目目标

### 主要目标
1. **内容公共化**：将所有用户上传的学习内容转为公共资源
2. **AI例句优化**：使用AI生成简短实用的自然例句
3. **数据迁移**：安全地将现有私有内容迁移到公共空间
4. **编辑权限开放**：允许所有用户编辑公共内容

### 成功指标
- 所有用户都能查看和使用任何用户上传的内容
- AI生成的例句质量明显优于当前模板生成
- 数据迁移过程零丢失
- 例句生成响应时间控制在合理范围内

## 3. 用户故事

### 作为学习者
- 我希望能够访问所有用户上传的词汇包和对话，这样我有更多学习资源
- 我希望看到的例句是自然流畅的，而不是僵硬的模板填充
- 我希望能够为不满意的例句重新生成更好的版本

### 作为内容贡献者
- 我希望我上传的内容能够帮助到所有学习者
- 我希望系统能自动为我上传的词汇生成高质量的例句
- 我希望能够编辑和完善其他用户上传的内容

### 作为系统管理员
- 我希望能够将现有的私有内容平滑迁移到公共空间without数据丢失
- 我希望系统能够高效处理AI例句生成请求

## 4. 功能需求

### 4.1 内容公共化功能

#### 4.1.1 数据结构调整
**需求编号：FR-001**
- 系统必须将用户上传的内容从用户私有路径（`users/{userId}/customVocabularyPacks`）迁移到公共路径（`publicContent/vocabularyPacks`）
- 系统必须保留内容的原作者信息
- 系统必须为每个内容项添加创建时间和最后修改时间
- 系统必须为每个内容项添加编辑历史记录功能

#### 4.1.2 内容访问功能
**需求编号：FR-002**
- 所有认证用户必须能够查看所有公共词汇包和对话
- 系统必须在内容列表中显示原作者信息
- 系统必须支持按作者、创建时间、修改时间等条件筛选内容
- 系统必须将公共内容与系统预设内容进行区分显示

#### 4.1.3 协作编辑功能
**需求编号：FR-003**
- 所有认证用户必须能够编辑任何公共内容
- 系统必须在用户编辑前显示警告提示，说明这是公共内容
- 系统必须记录所有编辑操作的用户和时间戳
- 系统必须支持简单的版本回滚功能（至少支持撤销上一次修改）

### 4.2 AI例句生成功能

#### 4.2.1 智能例句生成
**需求编号：FR-004**
- 系统必须使用AI服务为新上传的词汇自动生成英文和中文例句
- 系统必须确保生成的例句简短实用（英文15-25词，中文10-20字）
- 系统必须确保例句语法正确、语义合理
- 系统必须支持为现有词汇重新生成例句

#### 4.2.2 例句质量控制
**需求编号：FR-005**
- 系统必须提供手动重新生成例句的功能
- 系统必须支持用户手动编辑AI生成的例句
- 系统必须保留用户手动修改的例句，不被自动生成覆盖
- 系统必须提供"使用AI生成"和"手动编辑"两种模式的明确标识

#### 4.2.3 后台处理机制
**需求编号：FR-006**
- 系统必须支持批量例句生成的后台处理
- 系统必须为耗时的生成操作提供进度指示器
- 系统必须在生成完成后通知用户
- 系统必须确保生成过程中的错误不会影响内容保存

### 4.3 数据迁移功能

#### 4.3.1 私有内容迁移
**需求编号：FR-007**
- 系统必须提供一键迁移功能，将所有用户的私有内容转移到公共空间
- 系统必须在迁移前备份所有原始数据
- 系统必须确保迁移过程中数据完整性
- 系统必须在迁移完成后验证数据一致性

#### 4.3.2 重复内容处理
**需求编号：FR-008**
- 系统必须检测并处理迁移过程中的重复内容
- 对于相同的词汇或对话，系统必须合并为一个公共版本
- 系统必须保留所有作者信息在合并后的内容中
- 系统必须提供冲突解决机制（如不同用户有不同的翻译）

## 5. 非功能需求（范围外）

### 本版本不包含的功能：
- 内容审核和举报机制
- 复杂的权限管理系统
- 内容分级和推荐系统
- 详细的编辑历史和版本控制
- 用户积分或贡献排行系统

## 6. 设计考虑

### 6.1 数据库设计
- 公共内容集合：`publicContent/vocabularyPacks/{packId}`
- 公共对话集合：`publicContent/dialogues/{dialogueId}`
- 每个文档包含：原作者、创建时间、修改历史等元数据

### 6.2 AI集成
- 使用现有的Gemini AI服务
- 为例句生成设计专门的提示词模板
- 实现异步处理机制避免阻塞用户操作

### 6.3 用户界面
- 在内容卡片上显示"公共内容"标识
- 编辑时显示协作提示
- 为AI生成的例句添加特殊图标标识

## 7. 成功指标

### 定量指标
- 内容迁移成功率 = 100%（零数据丢失）
- AI例句生成成功率 ≥ 95%
- 例句生成平均响应时间 ≤ 10秒
- 用户对新例句质量满意度 ≥ 80%

### 定性指标
- 用户能够顺利访问所有公共内容
- 用户能够成功编辑公共内容
- AI生成的例句明显比原模板更自然
- 系统整体稳定性未受影响

## 8. 遗留问题

### 需要进一步讨论的问题：
1. 如果同一词汇有多个用户提供不同翻译，如何处理冲突？
2. 是否需要限制单个用户的编辑频率以防止恶意行为？
3. AI例句生成失败时的备用方案是什么？
4. 是否需要为公共内容添加使用统计功能？

### 技术待确认：
1. Firestore并发写入的冲突处理机制
2. AI服务的调用频率限制和成本控制
3. 大量数据迁移对系统性能的影响
4. 例句生成的批处理策略和优先级 